# Docker container for TuFuse
## Version: 1.60

TuFuse creates extended dynamic range (exposure blended) and extended depth of field (focus blended, focus stacked) images. TuFuse uses a technique known as Image Fusion to combine the best exposed and/or best focused regions of a stack of multiple images into a single fused composite image.

## Technical Background and Image Fusion Theory

TuFuse uses a modified version of an algorithm developed in Mertens et al. (2009) [1,2]. The algorithm basically (1) assigns quality measures to all pixels in a series of aligned input images and (2) creates a seamless composite image using a combination of the pixels from the input images where higher quality pixels contribute more to the final image. Quality measures are based on evaluations of contrast, saturation and well-exposedness.

The final composite image is created by using a weighted average of all the pixels in the input images where pixels with higher quality measures get more weight, combined seamlessly using a multi-resolution fusion algorithm first described by Burt and Adelson (1983) [3]. This algorithm describes how an image can be decomposed into a series (or pyramid) of frequency bandpassed images, and then recombined back into a single image. Taken together, they decompose a series of input images into multiple pyramids which are combined into a single pyramid based on pixel quality (i.e. how saturated, well exposed and/or well focused each pixel is), and finally collapsed to form a single composite image. The algorithm can also be used to identify and combine the best focused regions of images (using local contrast as a proxy for focus) into a single extended depth of field (DoF) image. A similar approach was already described by Pieper and Korpel (1983) and Ogden et al. (1985) [4,5].

TuFuse extends the above methods by implementing a two stage image fusion process. In its first iteration, TuFuse performs focus blending on images that share the same (or similar) exposure. The objective of this first iteration is to create a series of intermediate images that contain the best focused regions from input images that share the same exposure. In its second iteration, TuFuse performs exposure blending on the intermediate images produced by the first iteration, and any other images that were not processed during the first iteration. Tufuse analyzes the input images and automatically determines which images should be focus blended (iteration 1) and which images should be exposure blended (iteration 2). TuFuse uses different parameters for each of the two iterations, optimized to produce the best focused and best exposed result. TuFuse's two stage image fusion process can be bypassed and TuFuse can be made to perform the simple single stage image fusion process outlined by Mertens et al. (2009) [1]. Similarly, if TuFuse does not detect any images with the same (or similar) exposure, the first iteration is skipped, and TuFuse performs a single exposure blending iteration on the input images.

TuFuse's default approach to focus blending differs from the approach presented in Mertens et al. (2009) [1] in a couple of other respects. First, Tufuse uses a weighted average of the three measures (contrast, exposure and saturation) rather than a power function when calculating the quality of each pixel in the input images. Second, TuFuse offers that ability to choose the best pixel (rather than a weighted average of good pixels) when combining the input images into a single pyramid. Using the best pixel (see the options for laplacian combination mode below) tends to produce superior results when performing focus blending.

When performing exposure blending, TuFuse is designed to fuse multiple images taken at different exposures. However, it is possible to start with a single image, create a lighter and darker version of that image, and then perform image fusion on the three versions (original, lighter and darker). This technique (blending multiple versions of a single image) is sometimes known as fake HDR or pseudo HDR. TuFuse can automate this process using a feature called as auto-bracketing. When auto-bracketing is used, TuFuse creates a temporary lighter and/or darker version of each input image (adjusted by a user defined number of stops) and then fuses the two or three images into a single result. The resulting is an image in which shadows are brightened and/or highlights are darkened. If auto-bracketing is invoked, TuFuse only needs a single image as input.

The degree to which Burt and Adelson (1983) [3] adjust contrast (globally and locally), and smooth the transition between pixels from different images, depends on the number of levels in the pyramid that are used. TuFuse estimates the optimal size pyramid to (a) retain local contrast and (b) attenuate global contrast, but this can be adjusted by the user. In general, if too few levels are used, halos around regions of local contrast become visible, but if too many levels are used, the image will contain too much global contrast. The decision about the correct number of pyramid levels is at least as artistic as it is scientific, as it depends on factors such as the image's subject matter and personal preference.

When performing exposure blending, TuFuse weights pixels based on how well-exposed they are. TuFuse uses an exposure weight curve to determine the appropriate weight to assign to a pixel based on its brightness or intensity. By default, the weight curve is constructed so that the closer a pixel's intensity is to a mid-tone (i.e. 0.5 on a scale of 0 to 1, where 0 is black and 1 is white), the more weight it is assigned. However, adjusting TuFuse's beta parameter shifts the curve left or right, and changes what TuFuse considers to be the best exposed values. For example, a beta value of less than 0.5 will cause TuFuse to favor darker pixels with higher weights, and values greater than 0.5 will cause TuFuse to favor brigher pixels when assiging weights. TuFuse also allows adjustment of the spread of the exposure weight curve (via the sigma parameter). This alters the relative weights given to pixels that aren't well exposed (i.e. along the tails of the curve) compared to those that are well exposed (i.e. near the center of the curve).

TuFuse writes output in TIFF format. TuFuse can read both 8 bit JPEG and 8/16 bit TIFF files as input. TIFF files should have 3 or 4 channels per pixel stored in strip format (i.e. most TIFF files).

[1] - Tom Mertens, Jan Kautz and Frank Van Reeth (2009): Exposure Fusion: A Simple and Practical Alternative to High Dynamic Range Photography. Computer Graphics Forum 28(1): 161-171, doi:10.1111/j.1467-8659.2008.01171.x

[2] - https://github.com/Mericam/exposure-fusion

[3] - Peter J. Burt and Edward H. Adelson (1983): A Multiresolution Spline With Application to Image Mosaics. ACM Transactions on Graphics 2(4): 217-236. http://ai.stanford.edu/~kosecka/burt-adelson-spline83.pdf

[4] - J. M. Ogden, E. H. Adelson, J. R. Bergen and P. J. Burt (1985): Pyramid-Based Computer Graphics. RCA Engineer 30(5): 4-15. http://cholla.mmto.org/minerals/photos/RCA85.pdf

[5] - R. J. Pieper RJ and A. Korpel (1983): Image processing for extended depth of field. Applied Optics 22(10): 1449-1453. doi:10.1364/AO.22.001449

## Software availability
TuFuse was written and released by Max Lyons and is described as freeware. The original software is available here: http://www.tawbaware.com/tufuse.htm

